![マイクロソフト クラウド ワークショップ](https://github.com/Microsoft/MCW-Template-Cloud-Workshop/raw/master/Media/ms-cloud-workshop.png "マイクロソフト クラウド ワークショップ")

<div class="MCWHeader1">
Migrating SQL databases to Azure
</div>

<div class="MCWHeader2">
Whiteboard design session trainer guide
</div>

<div class="MCWHeader3">
June 2020
</div>

このドキュメントに記載されている情報 (URL 等のインターネット Web サイトに関する情報を含む) は、将来予告なしに変更されることがあります。特に断りがない限り、ここで使用している会社、組織、製品、ドメイン名、電子メール アドレス、ロゴ、人物、場所、イベントの例は、架空のものであり、実在する会社、組織、製品、ドメイン名、電子メール アドレス、ロゴ、人物、場所、イベントなどとは一切関係ありません。お客様ご自身の責任において、適用されるすべての著作権関連法規に従ったご使用を願います。このドキュメントのいかなる部分も、米国 Microsoft Corporation の書面による許諾を受けることなく、その目的を問わず、どのような形態であっても、複製または譲渡することは禁じられています。ここでいう形態とは、複写や記録など、電子的な、または物理的なすべての手段を含みます。ただしこれは、著作権法上のお客様の権利を制限するものではありません。

マイクロソフトは、このドキュメントに記載されている内容に関し、特許、特許申請、商標、著作権、またはその他の無体財産権を有する場合があります。別途マイクロソフトのライセンス契約上に明示の規定のない限り、このドキュメントはこれらの特許、商標、著作権、またはその他の無体財産権に関する権利をお客様に許諾するものではありません。

製造元や製品の名前、URL は情報の提供のみを目的としており、マイクロソフトは、これらの製造元、またはマイクロソフトの技術での製品の使用について、明示的、黙示的、または法的にいかなる表示または保証も行いません。製造元または製品の使用は、マイクロソフトによるその製造元または製品の推奨を意味するものではありません。サード パーティのサイトへのリンクが提供されている場合があります。このようなサイトはマイクロソフトの管理下にはなく、マイクロソフトは、リンクされたサイトの内容またはリンクされたサイトに含まれるリンク、あるいはこのようなサイトの変更または更新について責任を負いません。マイクロソフトは、リンクされたサイトから受信された Web キャストまたは他のいかなる形態の転送にも責任を負いません。マイクロソフトは、これらのリンクを便宜のみを目的として提供しており、いかなるリンクの使用も、マイクロソフトによるサイトまたはそこに含まれる製品の推奨を意味するものではありません。

© 2020 Microsoft Corporation.All rights reserved.

Microsoft および <https://www.microsoft.com/en-us/legal/intellectualproperty/Trademarks/Usage/General.aspx> に記載されている商標は、Microsoft グループの商標です。その他すべての商標は、該当する各社が所有しています。

**目次**

- [トレーナーの情報](#トレーナーの情報)
    - [トレーナーの役割](#トレーナーの役割)
    - [ホワイトボード設計セッションの流れ](#ホワイトボード設計セッションの流れ)
    - [ホワイトボード設計セッション前: 準備方法](#ホワイトボード設計セッション前-準備方法)
    - [ホワイトボード設計セッション中: 効果的なホワイトボード設計セッションのヒント](#ホワイトボード設計セッション中-効果的なホワイトボード設計セッションのヒント)
- [Azure への SQL データベースの移行のためのホワイトボード設計セッション受講者ガイド](#azure-への-sql-データベースの移行のためのホワイトボード設計セッション受講者ガイド)
    - [要約と学習目的](#要約と学習目的)
    - [ステップ 1: 顧客のケース スタディの確認](#ステップ-1-顧客のケース-スタディの確認)
        - [顧客の状況](#顧客の状況)
        - [お客様のニーズ](#お客様のニーズ)
        - [顧客の反論](#顧客の反論)
        - [一般的なシナリオのインフォグラフィック](#一般的なシナリオのインフォグラフィック)
    - [ステップ 2: 概念実証ソリューションの設計](#ステップ-2-概念実証ソリューションの設計)
    - [ステップ 3: ソリューションをプレゼンテーションする](#ステップ-3-ソリューションをプレゼンテーションする)
    - [まとめ](#まとめ)
    - [追加リファレンス](#追加リファレンス)
- [Azure への SQL データベースの移行のためのホワイトボード設計セッション トレーナー ガイド](#azure-への-sql-データベースの移行のためのホワイトボード設計セッション-トレーナー-ガイド)
    - [ステップ 1: 顧客のケース スタディの確認](#ステップ-1-顧客のケース-スタディの確認-1)
    - [ステップ 2: 概念実証ソリューションの設計](#ステップ-2-概念実証ソリューションの設計-1)
    - [ステップ 3: ソリューションをプレゼンテーションする](#ステップ-3-ソリューションをプレゼンテーションする-1)
    - [まとめ](#まとめ-1)
    - [推奨される対象者](#推奨される対象者)
    - [推奨ソリューション](#推奨ソリューション)
    - [反論への推奨される対応のチェックリスト](#反論への推奨される対応のチェックリスト)
    - [顧客の声 (最後に出席者に対して読み上げる)](#顧客の声-最後に出席者に対して読み上げる)

# トレーナーの情報

トレーナーとしてホワイトボード設計セッションをサポートするためにお時間を割いていただき誠にありがとうございます。

## トレーナーの役割

優れたトレーナーとは

- 安全に学習できる環境を構築します。

- 参加者の思考を刺激します。

- 参加者を学習プロセスに関与させます。

- 学習プロセスを管理します (時間どおりに、トピックに従って、参加者がメリットを得られるように調整します)。

- 個々の参加者の責任を徹底します。

- 参加者のためにすべてをまとめます。

- 学習プロセスへの洞察と経験を提供します。

- ホワイトボード設計セッションの議論を効果的に主導します。

- 参加者の成果物の品質と妥当性を監視します。

- フィードバック プロセスを効果的に主導します。

## ホワイトボード設計セッションの流れ

各ホワイトボード設計セッションは、次の流れで行います。

**ステップ 1: 顧客のケース スタディの確認 (15 分)**

**成果**

顧客のニーズを分析する

- 顧客の背景、状況、ニーズ、および技術的な要件

- 顧客の現在のインフラストラクチャとアーキテクチャ

- 潜在的な問題、反論、および阻害要因

**ステップ 2: 概念実証ソリューションの設計 (60 分)**

**成果**

ソリューションを設計し、そのソリューションを 15 分のチョークトーク形式で顧客の対象者にプレゼンテーションする準備をする

- 顧客の対象者を決定する

- 顧客のビジネス ニーズを判断してソリューションに取り組む

- ソリューションを設計して図で表す

- ソリューションのプレゼンテーションを準備する

**ステップ 3: ソリューションのプレゼンテーション (30 分)**

**成果**

ソリューションを顧客にプレゼンテーションする

- ソリューションをプレゼンテーションする

- 顧客の反論に回答する

- フィードバックを受ける

**まとめ (15 分)**

- 推奨ソリューションを確認する

## ホワイトボード設計セッション前: 準備方法

最初のホワイトボード設計セッションを実施する前に、以下を行います。

- 受講者ガイド (ケース スタディを含む) およびトレーナー ガイドを読む

- すべてのキー ポイントとアクティビティを十分に理解する

- 強調したいポイント、どの質問を活発化させたいか、および進め方を計画し、質問に回答する準備をする

- ホワイトボード設計セッションの前に、ケース スタディについて議論してさらにアイデアを集める

- 後で参照するためにメモを取る

## ホワイトボード設計セッション中: 効果的なホワイトボード設計セッションのヒント

**トレーナー ガイドを参照して**、セッションを円滑に進め、時間を守る。

ホワイトボード設計セッションの**詳細をすべて覚えようとしない**。

参加者がアクティビティを実施しているときに、**次に何を行うかを考えて、覚えていることを確認する**。

- 必要に応じて、**アクティビティとホワイトボード設計セッションのペースを調整して**、プレゼンテーション、フィードバック、および共有の時間を設ける。

- 自身の経験から、**例、ポイント、および事例を追加する**。共有できる事例の中から、ポイントを明確かつ効果的に伝えるのに役立つものがないか考えます。

- ホワイトボード設計セッションのスコープ外で発生した問題や疑問、または後で回答できる問題や疑問を記録する **"パーキング ロット" を設けることを検討する**。これらの問題をどのように解決するかを判断し、脱線することなく問題を確認できるようにします。

***楽しむ**。楽しんで共有するよう参加者に促します。*

**参加者を関与させる。** 話をして自身の知識を共有しますが、自分が話している間も常に参加者を関与させます。

グループを十分に学習プロセスに関与させるために、**質問をして**その内容を共有します。

可能な限り、**最初に質問から入る**。トピックを始める前に、そのトピックに関する対象者の意見と経験について学びます。最初に質問から入ることにより、対象者の知識と経験のレベルを評価し、対象者がプレゼンテーションの内容に対してオープンな姿勢を保つことができます。

**反応を待つ**。"(空欄に記入) についてどのような経験がありますか" のような質問をして、反応を待ちます。多少の沈黙は気にしないでください。こちらから沈黙を破ると、参加者を真剣には関与させようとしていないのではないかという印象を与え、参加者は受け身になってしまいます。参加者に考えるチャンスを与え、誰も答えない場合は、辛抱強くもう一度質問します。通常は反応があります。

# Azure への SQL データベースの移行のためのホワイトボード設計セッション受講者ガイド

## 要約と学習目的

このホワイトボード設計セッションでは、オンプレミスの VM と SQL Server 2008 R2 データベースを Azure 内の IaaS サービスと PaaS サービスの組み合わせに移行する計画をグループで作成します。トレーナーは、評価を実施して、顧客の SQL Server 2008 R2 データベースと Azure のマネージド データベース オファリングとの間の機能のパリティと互換性の問題を明らかにするためのガイダンスを提供します。次に、最小限のダウンタイムまたはゼロ ダウンタイムで顧客の VM およびデータベースを含むオンプレミス サービスを Azure に移行するためのソリューションを設計します。最後に、Azure で高度な SQL 機能のいくつかを有効にして、顧客のアプリケーションにおけるセキュリティとパフォーマンスを向上する方法についてのガイダンスを提供します。

このホワイトボード設計セッションを完了すると、ビジネスクリティカルなアプリケーションとデータベースのクラウド移行計画をより効果的に設計できるようになります。

## ステップ 1: 顧客のケース スタディの確認

**成果**

顧客のニーズを分析する

所要時間: 15 分

指示: セッションの参加者全員と共に、ファシリテーター/SME は、顧客のケース スタディの概要を技術的なヒントと併せてプレゼンテーションします。

1. テーブルの参加者およびトレーナーと打ち合わせを行います。

2. 受講者ガイドのステップ 1 ～ 3 の指示をすべて読みます。

3. テーブル チームとして、次の顧客のケース スタディを確認します。

### 顧客の状況

Wide World Importers (WWI) の子会社である Tailspin Toys は、いくつかの人気のあるオンライン ゲームを開発した企業です。2010 年に設立された同社は、オンラインの多人数ゲームを含んだ、非常に人気のあるゲーム シリーズの第一弾リリース以降、急激な成長を遂げました。以来、同社はゲーム ポートフォリオの大部分にオンライン機能を追加することで、その成功を積み重ねてきました。

オンライン ゲームプレイを促進するために、同社は保守的なアプローチを取ることにし、レンタルのハードウェアを使用してオンプレミスでゲーミング サービスをホストしました。このアプローチによって、最小限の初期投資でオンライン ゲーム市場に参入し、リスクを低減することができました。各ゲームに対して、同社のゲーミング サービスのセットアップは、ゲーミング ソフトウェアを実行する 3 台の仮想マシンと、単一の SQL Server 2008 R2 Enterprise インスタンス上でホストされる 5 台のゲーム データベースで構成されます。これらは、ゲーミング データベース間でメッセージを送信するために SQL Server の Service Broker 機能を使用します。専用のゲーミング VM およびデータベースに加えて、同社のゲーミング サービスには認証およびゲートウェイの VM およびデータベースが含まれており、すべてのゲームで共有されています。

WWI の CIO である Molly Fischer 氏は、オンライン ゲームプレイを追加したことで、当初の予想をはるかに上回る反応があったと語りました。ゲームの人気上昇で収益性は向上しましたが、サービスの需要の急激な増加によって、現在のセットアップをサポートする上で問題が生じるようになりました。Tailspin Toys は基本的にゲーム開発企業であり、主にソフトウェア開発者によって構成されています。データベースおよびインフラストラクチャ専門のリソースは少数で、拡大を続けるワークロードに対応するのに苦戦しています。ゲーム開発者がインフラストラクチャのサポートを支援するために介入しなければならないことがますます増え、ゲーム開発にあてる時間が奪われ、リリースのタイムラインを守れなくなる事態が何度か生じました。Molly 氏は、コア ビジネスの範囲外のことになるため、追加の非開発者リソースを投入することに対する懸念を表しています。彼女は、サービスをオンプレミスからクラウドに移行することによって、インフラストラクチャ管理タスクをいくらか軽減できると同時に、新しい改良されたゲームをリリースすることでビジネス価値を提供するという同社の取り組みに再度集中できるようになることを期待しています。

この問題をさらに複雑化させているのが、一番人気のゲームの新しいバージョンのリリース スケジュールです。同社には 12 ～ 18 か月ごとに新しいバージョンをリリースするという目標スケジュールがありますが、これはリリースする新しいバージョンごとに新しい VM 数台とデータベース サーバー 1 台を追加することを意味し、その一方で以前のゲーム バージョンすべてのサービスを維持し続ける必要があります。新しいリリースごとに、レンタル機器のコストが増加し、ただでさえ過剰負担状態にある従業員のワークロードをさらに着実に増やしていくことになります。同社は社内で古いゲーム バージョンのサポート終了シナリオについて話し合いましたが、これらのゲームの多くで依然として多くのプレイヤーが存在しているため、これらのゲームをいつサポート終了にするかについての決定は結局行われませんでした。

WWI は、現在のハードウェア レンタル契約が 3 か月で終了するため、契約更新はせず、既存の VM を Azure に移行したいと考えています。3 か月という期間はいかにも短いことは重々承知の上で、適切なリソースを専用に割り当てるなら、ゲーミング サービス VM のリフト アンド シフト アプローチが実現可能なのではないかと期待しています。同社には既に、このプロセスに使用できる、各ゲームの VM イメージがあります。彼らはリフト アンド シフトに関係する作業についてさらに詳しく知って、それに基づいてリソース割り当てを計画することを望んでいます。さらに、このアプローチを使用して VM およびデータベース展開をゲームごとにさらに適切にスケーリングできるかということも知りたいと願っています。現在、各ゲームとバージョンに同じ数の VM とデータベースを使用していますが、人気のあるゲームではより多くのゲーマーをホストしなければならないという問題にしばしば直面しています。新しいリリースとより人気のあるゲームの需要を満たすためにスケールアップし、古い、人気の低いゲームではスケールダウンできる能力を必要としています。また、ゲーミング サービスをグローバルに配信することで、世界中のさまざまな場所からサービスにアクセスするゲーマーによって報告される待機時間の問題を解決できるかどうかということも調査することを望んでいます。

WWI のリーダーシップ チームにとっての大きな懸念は、SQL Server 2008 R2 のサポート終了日が足早に迫っていることです。同社のデータベース向けに、Azure のフルマネージドの PaaS (サービスとしてのプラットフォーム) オプションについて詳しく知りたいと考えています。実際のデータベース管理スキルを持つ従業員がいないため、これはインフラストラクチャのワークロードを減らすための優れた最初の一歩になると感じています。同社は、現在のデータベース と Azure の Paas オプション間の互換性の問題を評価するための支援を要請しました。彼らは、SQL Server の Service Broker 機能が Azure では利用できないことを知りました。同社はいくつかの重要なゲーミング プロセスでこの機能を使用しており、ゲーミング データベースをクラウドに移行する際にこの機能を失うわけにはいきません。また、この時にゲーミング サービスを再設計して別のメッセージ ブローカーを使用するためのリソースがないということも述べています。

ゲーミング サービスに加えて、WWI はデータ ウェアハウスとその関連するサービスをクラウドに移行することにも関心を持っています。現在、専用の SQL Server 2008 R2 インスタンスにデータ ウェアハウスをホストしています。データ ウェアハウスのサイズは現在約 20 TB で、毎月約 250 GB のペースで増加しています。ゲーム サーバーのリモート監視および分析とユーザー テレメトリ (ゲームおよびその他の対話との対話などのプレーヤーの動作に関するデータ) を含む多数のゲーム テレメトリ データ ポイントを収集しています。ゲーミング ソフトウェアに埋め込まれたコードは、ゲーミング データベースにデータを転送します。そのテレメトリ データは、SQL Server Integration Services (SSIS) によって 1 時間ごとに読み込まれます。データ ウェアハウス内のデータを使用して、同社は SQL Server Analysis Services (SSAS) キューブを構築し、SQL Server Reporting Services (SSRS) を使用してレポートを作成します。SSRS レポートは SharePoint 環境内のサイトに展開されます。また、カスタマー サービス担当者と開発者がさまざまな活動のためにデータ ウェアハウスに接続することにも気付いています。

さらに、リアルタイムのユーザー テレメトリとゲーミング メトリックを分析できるように、いくつかのレポートはゲーミング データベースに対して直接実行されている点についても言及しました。このようなレポートは多くありませんが、開発者とビジネス ユーザーにとっては重要なものです。ゲーミング アクティビティのピーク時期に、これらのレポートの実行が非常に低速になり、ゲーミング パフォーマンスにも時折影響を及ぼしていることが観察されています。彼らは、これまでに経験しているパフォーマンスへの影響を軽減するような方法で、これらのレポートを引き続き実行する方法がないかどうかを知りたいと思っています。

WWI は、クラウドへの移行により、どのように全体的なプロセスを改善すると共に、オンプレミスのセットアップで抱えている懸念事項や問題を解決できることについてさらに詳しく知りたいとして、期待を高めています。目下、ゲーミング VM とデータベースをクラウドに移行するための概念実証 (PoC) を実施しようとしています。最終目標はサービス全体をクラウドに移行することであるため、クラウドへの移行後に全体的なアーキテクチャがどのようになるかをさらに詳しく理解したいと考えています。

現在の環境をより良く理解できるようにするため、WWI はオンプレミスのゲーミング サービス実装の以下のアーキテクチャ図を提供しています。

![現在のアーキテクチャ図。](media/current-architecture.png "現在のアーキテクチャ")

### お客様のニーズ

1. 可能な限り PaaS サービスを使用して、すべてのゲーミング サービス インフラストラクチャをクラウドに移行したい。機器レンタル契約を更新しなくてよいように、3 か月以内にこれを実行可能かどうかを知りたい。

2. ゲーミング サービスに加えて、既存のデータ ウェアハウスを Azure に移行して、そこで利用可能ないくつかの新しい SQL 機能によってスケールアウトする機能を活用したい。この要請の一環として、以下のことについて知りたい:
   
   - より多くの要求を処理できるようデータ ウェアハウスをスケールアウトする機能の追加。
   - SSIS パッケージ、SSAS キューブ、および SSRS レポートのアップグレード パス。

3. 移行コストを可能な限り最小限に抑える方法についての推奨事項を知りたい。

4. 当社のデータベースのセキュリティ体制を改善したい、また潜在的な脆弱性とコンプライアンスの問題について知りたい。

5. 世界中のその他の地域のゲーマーから高待機時間の不満が寄せられており、高使用率のピーク時にはゲームに参加できないという報告もある。当社のゲーミング サービスをクラウドに移行することで、以下の点を含む全体的なゲーミング エクスペリエンスを向上することを希望している。
   
   - 世界中のさまざまな場所から当社のサービスにアクセスするゲーマーの待機時間を削減する。
   - ピーク時または新しいゲームのリリース時により多くのプレイヤーをホストできるようにする。
   - 冗長性を追加してゲーミング サービスの高可用性を確保する

6. 地域的な障害発生時には、数分以内にゲーミング サービスを再開し、48 時間以内にデータ ウェアハウスを回復したい。

### 顧客の反論

1. Azure で SQL データベースをホストするための複数のオプションがあるように見える。それぞれのオプションはどのようなものか、また違いは何か? すべてのオプションはオンプレミスの SQL Server インスタンスとして同じ機能をサポートするのか、それとも移行前に注意すべきサポートされない機能があるのか? Azure の PaaS データベースで引き続き Service Broker を使用できるのか?

2. Azure のさまざまな SQL Database ホスティング オプションのうちどれが当社の現在の SQL Server 2008 R2 データベースで動作するかを評価するためのツールはあるか? その他の SQL バージョンに対して対象となるワークロードをテストする方法があるか? 移行を試行する前に潜在的な問題や非互換性を識別するためのツールがあるか?

3. クラウドへの移行において、バックエンドのネットワークを完全に分離して、セキュリティで保護されたチャネルを介したフロントエンド接続のみを有効にした状態で、オンプレミスの開発環境に接続し、そこからトラブルシューティングを行う機能を保持できるか?

4. 特定のクラウド ベンダーに囲い込まれたくない。データベースをホストするために PaaS サービスを使用しつつ、同時に有効な出口戦略を持つことは可能か? あるいは、データベースのホストにあたっては あくまで Azure での VM の使用に限定しなくてはならないのか?

### 一般的なシナリオのインフォグラフィック

![一般的なシナリオのインフォグラフィックが表示されている。](media/common-scenario-infographic.png "一般的なシナリオ")

## ステップ 2: 概念実証ソリューションの設計

**成果**

ソリューションを設計し、そのソリューションを 15 分のチョークトーク形式で顧客の対象者にプレゼンテーションする準備をする

所要時間: 60 分

**ビジネス ニーズ**

指示: テーブルのすべての参加者と共に以下の質問に回答し、回答をフリップ チャートに一覧にします。

1. このソリューションを誰にプレゼンテーションするべきか。顧客の対象者は誰か。意思決定者は誰か。

2. ソリューションで解決する必要がある顧客のビジネス ニーズは何か。

**設計**

指示: テーブルのすべての参加者と共に、フリップ チャートの次の質問に回答します。

アーキテクチャの概要

1. 詳細には触れずに (詳細には以降のセクションで対応)、ゲーム データベース、ゲーミング サービス VM、データ ウェアハウス、および関連するサービスに関する最上位の要件に対応するための初期ビジョンを図示する。この図は作業の進行に伴って詳細にしていく。

2. 移行コストをどのように最小限に抑えられるか?

3. WWI のゲーミング サービスを 3 か月以内に移行することは可能か?

4. どのような機能を POC に含める必要があるか?

ゲーム データベース

1. WWI が Azure で SQL データベースをホストするために PaaS または IaaS オプションのどちらを使用するかを決定する際に考慮すべき要素にはどのようなものがあるか?

2. Azure で SQL データベースをホストするためのオプションのうち、同社のゲーミング サービスをホストするためにどれを推奨するか、それが最適な選択肢であると考える理由は何か? どのような価格レベルを推奨するか?

3. データ移行にどのように対応するか? 評価からデータ移行にいたるまでの段階的な説明を提供してください。

4. WWI のセキュリティ体制を改善するために Azure SQL Managed Instance で利用可能な機能にはどのようなものがあるか?

5. ゲーミング データベースに対して直接実行される読み取り専用レポートの影響を低減するために利用できる PaaS データベース サービスの機能はあるか?

ゲーミング サービス

1. WWI ではどのようにゲーミング サービス VM の Azure への移行に対応するべきか?

2. 世界のその他の地域のゲーマーが経験している待機時間の問題を解決するためにどのような対策を推奨するか?

3. ゲーミング サービスをスケールアップまたはスケールダウンするための機能はどのようなものであるべきか?

4. ゲーミング サービスの高可用性を実現するにはどうすればよいか?

データ ウェアハウスとレポート

1. Azure でのデータ ウェアハウスのためのターゲット プラットフォームとして何を推奨するか?

2. より多くの要求を処理できるようデータ ウェアハウスを読み取りスケールアウトするにはどうすればよいか?

3. SSIS パッケージ、SSAS キューブ、および SSRS レポートのアップグレード パスはどのようなものか?

地域的な障害

1. ゲーミング サービスを指定された RTO/RPO 内で回復するにはどうすればよいか?

**準備**

指示: テーブルのすべての参加者と共に、以下を行います。

1. 提案したソリューションでは対応していない顧客ニーズを特定する。

2. ソリューションの利点を特定する。

3. 顧客の反論にどのように回答するかを決定する。

顧客に対する 15 分のチョークトーク形式のプレゼンテーションを準備する。

## ステップ 3: ソリューションをプレゼンテーションする

**成果**

顧客の対象者にソリューションを 15 分のチョークトーク形式でプレゼンテーションする

所要時間: 30 分

**プレゼンテーション**

指示:

1. 別のテーブルとペアを組む

2. 一方のテーブルはマイクロソフト チーム、他方のテーブルは顧客とする

3. マイクロソフト チームは提案ソリューションを顧客にプレゼンテーションする

4. 顧客は反論リストから反論を 1 つ行う

5. マイクロソフト チームは反論に回答する

6. 顧客チームはマイクロソフト チームにフィードバックを提供する

7. テーブル間で役割を切り替えて、ステップ 2 ～ 6 を繰り返す

## まとめ

所要時間: 15 分

指示: より大きなグループでテーブルに再度集まり、ファシリテーター/SME がこのケース スタディの推奨ソリューションを共有するのを聞きます。

## 追加リファレンス

| | |
|----------|----------|
| **説明** | **リンク** |
| Azure で適切な SQL Server オプションを選択する| <https://docs.microsoft.com/azure/azure-sql/azure-sql-iaas-vs-paas-what-is-overview>
| サービスとしての SQL Database プラットフォーム| <https://docs.microsoft.com/azure/azure-sql/database/sql-database-paas-overview>
| ビジネス継続性| <https://docs.microsoft.com/azure/azure-sql/database/business-continuity-high-availability-disaster-recover-hadr-overview>
| 高可用性| <https://docs.microsoft.com/azure/azure-sql/database/high-availability-sla>
| 自動バックアップ| <https://docs.microsoft.com/azure/azure-sql/database/automated-backups-overview>
| 長期的なバックアップ保有期間| <https://docs.microsoft.com/azure/azure-sql/database/long-term-retention-overview>
| 自動フェールオーバー| <https://docs.microsoft.com/azure/azure-sql/database/auto-failover-group-overview>
| リソースのスケーリング| <https://docs.microsoft.com/azure/azure-sql/database/scale-resources>
| 機能比較: Azure SQL Database と SQL Server| <https://docs.microsoft.com/azure/azure-sql/database/features-comparison>
| Azure SQL Managed Instance| <https://docs.microsoft.com/azure/azure-sql/managed-instance/sql-managed-instance-paas-overview>
| SQL MI 用の接続アーキテクチャ| <https://docs.microsoft.com/azure/azure-sql/managed-instance/connectivity-architecture-overview>
| アプリを SQL MI に接続する| <https://docs.microsoft.com/azure/azure-sql/managed-instance/connect-application-instance>
| Azure SQL Database サービス レベル| <https://docs.microsoft.com/azure/azure-sql/database/service-tiers-general-purpose-business-critical>
| Azure SQL MI の概要| <https://docs.microsoft.com/azure/azure-sql/managed-instance/quickstart-content-reference-guide>
| データベース移行ガイド| <https://datamigration.microsoft.com>
| Database Migration Assistant| <https://docs.microsoft.com/sql/dma/dma-overview?view=azuresqldb-mi-current>
| Azure Database Migration Service| <https://docs.microsoft.com/azure/dms/dms-overview>
| SQL Server を Azure SQL Managed Instance に移行する| <https://datamigration.microsoft.com/scenario/sql-to-azuresqldbmi>
| Azure SQL Managed Instance に移行する| <https://docs.microsoft.com/azure/dms/tutorial-sql-server-to-managed-instance?toc=/azure/sql-database/toc.json>
| DMS を使用した SQL Server から Azure SQL Managed Instance への移行| <https://docs.microsoft.com/azure/dms/tutorial-sql-server-managed-instance-online?view=sql-server-2017>
| Azure SQL Database の価格| <https://azure.microsoft.com/pricing/details/sql-database/managed>
| Azure SQL Database のセキュリティ機能の概要| <https://docs.microsoft.com/azure/azure-sql/database/security-overview>
| Advanced Data Security| <https://docs.microsoft.com/azure/azure-sql/database/advanced-data-security>
| データの検出および分類| <https://docs.microsoft.com/azure/azure-sql/database/data-discovery-and-classification-overview>
| SQL 脆弱性評価サービス| <https://docs.microsoft.com/azure/azure-sql/database/sql-vulnerability-assessment>
| 脅威検出| <https://docs.microsoft.com/azure/azure-sql/database/threat-detection-overview>
| SQL Database 読み取りスケールアウト| <https://docs.microsoft.com/azure/azure-sql/database/read-scale-out>

# Azure への SQL データベースの移行のためのホワイトボード設計セッション トレーナー ガイド

## ステップ 1: 顧客のケース スタディの確認

- テーブルの参加者に会い、自身をトレーナーとして自己紹介する。

- "顧客のケース スタディについてどのような質問があるか" と尋ねる。

- ホワイトボード設計セッションのステップと所要時間を簡単に確認する。

- 準備が整ったら、テーブルの参加者に開始させる。

## ステップ 2: 概念実証ソリューションの設計

- テーブルを回り、各ステップが時間どおりに進んでいることを確認する。

- ビジネス ニーズと設計への回答について何らかのフィードバックを提供する。
  
  - 最初に、参加者が自分自身で回答を見つけやすくなるような質問をしてみる。

- 顧客の反論への回答にフィードバックを提供する。
  
  - 最初に、参加者が自分自身で回答を見つけやすくなるような質問をしてみる。

## ステップ 3: ソリューションをプレゼンテーションする

- ステップ 3 の開始前に、どのテーブルが自分のテーブルとペアを組むかを決定する。

- 1 回目では、一方のテーブルをプレゼンテーション チームとして割り当て、他方を顧客として割り当てる。

- プレゼンテーション チームがそのソリューションを顧客チームにプレゼンテーションする。
  
  - プレゼンテーション チームが回答すべき反論を、顧客チームから 1 つ提供する。
  
  - プレゼンテーション、反論、およびフィードバックは 15 分以内に収める必要がある。
  
  - 必要に応じて、トレーナーもフィードバックを提供できる。

## まとめ

- より大きなセッション グループにテーブルの参加者を再度集め、ファシリテーター/SME が次の推奨ソリューションを共有するのを聞きます。

## 推奨される対象者

Wide World Importers の最高情報責任者 (CIO)、Molly Fischer 氏

主要対象者は、ビジネスおよび技術担当の意思決定者です。ケース スタディのシナリオから、アナリティクス担当ディレクターが含まれます。通常は、CIO (最高情報責任者) に直属のインフラストラクチャ マネージャー、アプリケーション スポンサー (LOB (基幹業務) 担当 VP (副社長)、CMO (最高マーケティング責任者) など)、あるいはアプリケーション スポンサーにレポートするビジネス ユニットの IT 部門または開発者の代表者に話をします。

## 推奨ソリューション

アーキテクチャの概要

1. 詳細には触れずに (詳細には以降のセクションで対応)、ゲーム データベース、ゲーミング サービス VM、データ ウェアハウス、および関連するサービスに関する最上位の要件に対応するための初期ビジョンを図示します。作業の進行に伴ってこの図を詳細にしていきます。
   
   ゲーミング データベースに対する Microsoft Data Migration Assistant の評価の実施後、WWI は、Azure SQL Managed Instance により、フルマネージドの Azure PaaS サービスでのデータベースのホスティングが可能になると判断しました。SQL MI により、データベースを変更することなくこれを行えるため、ゲーム開発に焦点を戻し、データベースの管理に関する心配に多くの時間を費やさずに済みます。同社は、ダウンタイムを最小限に抑えるために、Azure Database Migration Service のオンライン データ移行機能を利用することにしました。
   
   ![考えられるターゲット アーキテクチャ。](media/target-architecture.png "ターゲット アーキテクチャ")
   
   大まかに説明すると、認証およびゲートウェイ サービス VM は、シンプルなリフト アンド シフトを行って Azure VM に移行されます。また、2 つのバックエンド認証データベースが単一の Azure SQL MI (General Purpose サービス レベル) に移行されます。認証サービスは、同じリージョン内のゲーム間で共有されます。同社のゲーミング ソフトウェア VM は Azure VM に移行され、5 つのゲーミング データベースを実行する単一の SQL MI インスタンスに関連付けられます。このセットアップはゲームごとに繰り返されます。ゲームおよび認証データベースは、Azure Database Migration Service を使用して移行されます。
   
   もう少し詳しく説明すると、以下の図のように、ゲームごとに、ゲーム サービス用サブネット、マネージド インスタンス用サブネット、認可サービス用サブネット、管理用サブネット、およびゲートウェイ サブネットを持つ、分離された VNet が作成されます。
   
   ![ターゲットのゲーミング サービス アーキテクチャの詳細図が表示されている。分離された VNet 内でリソースがサブネットに分割されている。このセットアップは各ゲームに使用される。](media/target-architecture-gaming-services.png "ゲーミング サービス アーキテクチャ")
   
   より多くの要求に、より容易に対応するためだけでなく、現在保有している大量のデータを格納するために、同社のデータ ウェアハウスは Azure SQL Database Hyperscale に移行されます。ゲーミング データベースからデータ ウェアハウスへのテレメトリ データの移行は、Azure Data Factory (ADF) の Azure-SSIS Integration Runtime を使用して行われます。既存の SSIS パッケージと同様に、ADF で毎時間実行されるようにデータのスケジュール設定を行うことができます。データ ウェアハウスから、クラウドでデータ モデリングを提供する目的で Azure Analysis Services (Azure AS) が使用されます。現在、SSRS には同等のクラウド ベースの機能が存在しないため、Microsoft Power BI を使用してお客様のレポートが再作成されます。レポートは、別の SQL MI (General Purpose) インスタンスによってサポートされる、Azure VM で実行される SharePoint に送信されます。
   
   オンプレミスのユーザー、開発者、およびカスタマー サービス担当者は、ExpressRoute 接続または VNET ピアリングを使用して Azure のリソースに接続し、トラブルシューティングを行ったり、レポートにアクセスしたりすることが可能になります。
   
   推奨ソリューションは、実現可能な数多くのオプションの 1 つに過ぎません。

2. 移行コストをどのように最小限に抑えられるか?
   
   Azure ハイブリッド特典
   
   ワークロードをクラウドに移行することで、データ層の管理の負担を軽減し、時間とコストを節約できます。
   
   SQL Server 向けの [Azure ハイブリッド特典](https://azure.microsoft.com/pricing/hybrid-benefit/)は、最小限の労力で SQL Server データベースを Azure に移行できるコスト効果の高い手段を提供します。この特典を利用することで、ソフトウェア アシュアランス付きの既存の SQL Server ライセンスを使用して、クラウドへの移行時の料金を削減できます。WWI は、Azure ハイブリッド特典を利用することで、コストを最大 55% 削減できます。 
   
   予約容量の前払い
   
   [予約容量](https://docs.microsoft.com/azure/azure-sql/database/reserved-capacity-overview)によるコンピューティング リソース料金の前払いもお勧めです。これにより、従量課金制よりも料金が安くなります。Azure SQL Database の予約容量を利用して、SQL Database の料金を 1 年分または 3 年分前払いすることで、コンピューティング料金に対して大幅な割引が適用されます。これにより、コストを最大 80% 削減できます。
   
   Azure Database Migration Service
   
   [Azure Database Migration Service](https://docs.microsoft.com/azure/dms/dms-overview) を利用して、複数のツールではなく、単一の包括的なサービスを使用することで、クラウドへの移行のコストと複雑さを軽減できます。

3. WWI のゲーミング サービスを 3 か月以内に移行することは可能か?
   
   3 か月の期間で移行をすべて完了できるという保証はありませんが、成功の可能性を高めるために WWI が実施できる手順や利用できるツールは存在します。
   
   Azure Database Migration Service (DMS) を利用することで、データベースの移行プロセスを簡素化できます。ゲーミングおよび認証データベースに関して、DMS は、最小限の時間と労力で数多くのデータベースを Azure SQL Managed Instance に移行できるシンプルなツールを提供します。また、SQL MI を利用することで、クラウドを素早く稼働するのに必要なアプリケーションやデータベースの変更を最小限に抑えることができます。これを利用することで、データべースを稼働状態のまま移行できるため、オンライン サービスへのカットオーバーの準備や管理に要する時間が短縮されます。また、DMS を利用することで、Azure SQL DB Hyperscale へのデータ ウェアハウスの移行に対応できます。
   
   Azure Site Recovery (ASR) を利用することで、オンプレミス VM を Azure VM に素早く簡単にレプリケートできます。ASR は事業継続とディザスター リカバリー向けに設計されていますが、Azure へのオンプレミス VM のレプリケーションを管理する目的でも利用できます。
   
   WWI チームは、移行プロジェクトを担当する専用リソースが必要になります。WWI チームは、大規模なクラウドの移行を実施してきた経験を持つマイクロソフトのパートナーを迎え入れることでメリットを享受し、プロセスを加速させ、非常に厳しいスケジュールにも対応できる可能性を高めることができます。

4. どのような機能を POC に含める必要があるか?
   
   POC には以下を含める必要があります。
   
   - Azure で 1 つのゲームをホストするのに必要なすべての資産:
     
     - 認証およびゲートウェイ サービス:
       - VM は、Azure Virtual Machines でホストする必要があります。
       - 1 つの SQL MI (General Purpose レベル) インスタンスで 2 つの認証データベースをホストする必要があります。
     - 1 つの SQL MI (Business Critical レベル) インスタンスでホストされる 5 つのゲーミング データベース。
     - Azure VM に移行される 3 台のゲーミング サービス仮想マシン。
   
   - アップグレードされるデータ ウェアハウス:
     
     - データベースの規模および接続するユーザーの数に対応するために、Azure SQL DB Hyperscale でホスト。
     - アップグレードされる SSIS、SSAS、および SSRS。
     - Azure SQL DB で新機能を実装 (テーブル圧縮、Transparent Data Encryption、クラスター化列ストア インデックスなど)。
   
   - VNet の分離:
     
     - SQL MI に備わっている機能。
     - データベース管理用の管理サブネット。
     - SQL MI VNet への VNet ピアリングを備えた、ゲーミング サービス VM をホストするためのゲーミング サービス VNet。
     - オンプレミス開発マシンからデータベースに接続してトラブルシューティングを行うためのセキュアなチャネル。

ゲーム データベース

1. WWI が Azure で SQL データベースをホストするために PaaS または IaaS オプションのどちらを使用するかを決定する際に考慮すべき要素にはどのようなものがあるか?
   
   以下のさまざまな要素に基づいて、Azure で SQL データベースをホストするために PaaS または IaaS のどちらのオプションを使用するかを決定する必要があります。
   
   - **コスト**: PaaS オプションでも IaaS オプションでも、基礎となるインフラストラクチャやライセンスの費用が基本料金に含まれています。ただし、IaaS オプションの場合、データベースの管理に余分な時間とリソースを費やす必要があります。一方、PaaS の場合、多くの管理機能が料金に含まれています。
   
   - **管理**: PaaS オプションの場合、データベースの管理に要する時間が短くなります。ただし、実行できるカスタムの管理タスクやスクリプトの範囲も制限されます。
   
   - **サービス レベル アグリーメント**: PaaS でも IaaS でも、高水準かつ業界標準の SLA が提供されます。PaaS オプションの場合、99.99% の SLA が保証されます。IaaS の場合、インフラストラクチャに対して 99.95% の SLA が保証されます。つまり、データベースの可用性を確保するためのメカニズムを追加で実装しなければならない可能性があります。
   
   - **Azure への移行にかかる時間**: Azure VM 上の SQL Server は、同社の環境と完全に一致するため、オンプレミスから Azure SQL VM への移行は、オンプレミス データベースを他のオンプレミス データベース サーバーに移行するのとまったく変わりません。SQL Managed Instance を利用して、簡単に移行することもできます。ただし、マネージド インスタンスに移行する前に、多少の変更が必要になる場合があります。SQL DB が適したターゲットとなる可能性もありますが、他のオプションよりも機能や互換性に関する懸念事項が多いため、オンプレミス データベースによっては最遅のオプションにもなり得ます。

2. Azure で SQL データベースをホストするためのオプションのうち、同社のゲーミング サービスをホストするためにどれを推奨するか、それが最適な選択肢であると考える理由は何か? どのような価格レベルを推奨するか?
   
   Azure でゲーミング データベースをホストするためのオプションのうち推奨されるのは、Azure SQL Managed Instance (Business Critical サービス レベル) の使用です。
   
   お客様は、可能であれば、PaaS オファリングを使用したいという要望を示しています。SQL MI は、PaaS データベース サービスのメリットを備えたフルマネージド プラットフォームを提供します。Database Migration Service と組み合わせることで、ダウンタイムを短時間またはゼロに抑えながら、簡単にデータベースを Azure に移行できます。Service Broker 機能の利用とともに、お客様のデータベース数の多さを考慮に入れると、SQL MI が最適なソリューションとなります。また、SQL MI を利用することで、VM 上の SQL Server の使用に伴って発生する可能性があるコストや管理オーバーヘッドも削減できます。Service Broker を利用する場合、まず、データベース アーキテクチャを変更しなければ SQL DB を使用できません。また、SQL MI は、お客様が要求している VNet の分離とセキュリティ向上を実現します。
   
   お客様は、既存の構成のサポートに必要なインフラストラクチャ/データベース リソースを保有しておらず、それらのスキルを備えた新たなリソースをチームに加えたくないと明確に述べています。お客様は、管理するインフラストラクチャやコストの削減を希望しているため、VM 上の SQL は検討対象から外れます。
   
   Business Critical サービス レベルは、最高水準のパフォーマンスと HA を必要とするアプリケーション向けに設計されています。ゲーミング アプリケーションおよびデータベースの性質を考慮に入れると、お客様は、可能な限り最短の IO 待機時間、最高水準の可用性、最適なパフォーマンスを実現するサービス レベルを使用する必要があります。また、組み込みの読み取り専用レプリカが含まれており、追加コストなしで、プライマリ データベースの一部のワークロードをレポートおよび読み取り専用ワークロードとして扱うことができます。

3. データ移行にどのように対応するか? 評価からデータ移行にいたるまでの段階的な説明を提供してください。
   
   データの移行には、最小のダウンタイムというお客様の要件を満たす Azure Database Migration Service のオンライン データ移行機能を使用して対応する必要があります。データ プラットフォームの移行には、完全なソフトウェア/ハードウェア プロジェクトと同じ厳密さとプロセスで対応する必要があります。つまり、成功のための確実な方法が必要となります。
   
   移行プロジェクトの計画時、次の図で示されているのと同様のプロセスを検討する必要があります。
   
   ![データ プラットフォームの移行プロセスの概要を示す図。](media/data-platform-migration-process.png "データ プラットフォームの移行")
   
   移行前:
   
   - **検出**: ソース データベースの資産のインベントリを作成し、アプリケーション スタックの検出を実施。
   - **評価**: ソース ワークロードを評価し、推奨事項を決定。
   - **変換**: ターゲット環境で動作するようソース スキーマを変換。これは異種環境の移行にのみ関係します。
   
   移行:
   
   - **スキーマ、データ、およびオブジェクトの移行**: ソース スキーマを移行した後、ソース データをターゲットへ移行。
   - **データの同期**: ターゲット スキーマとデータをソースと同期。これは最小限のダウンタイムによる移行にのみ関係します。
   - **カットオーバー**: ソースからターゲット環境へのカット オーバー。これは最小限のダウンタイムによる移行にのみ関係します。
   
   移行後:
   
   - **アプリケーションの修復**: アプリケーションに対して必要な変更を繰り返し実施。
   - **テストの実施**: 機能およびパフォーマンス テストを繰り返し実施。
   - **最適化**: 実施したテストに基づいて、パフォーマンスの問題を解決し、その後再テストを行ってパフォーマンスが改善されたことを確認。

4. WWI のセキュリティ体制を改善するために Azure SQL Managed Instance で利用可能な機能にはどのようなものがあるか?
   
   SQL MI には、WWI が活用できる以下のような数多くのセキュリティ ツールが含まれています。
   
   - [SQL Database Advanced Data Security](https://docs.microsoft.com/azure/azure-sql/database/advanced-data-security) (ADS) は、機密データを検出して分類する機能、潜在的なデータベースの脆弱性を示して軽減させる機能、データベースに対する脅威を示している可能性がある異常なアクティビティを検出する機能など、高度な SQL のセキュリティ機能を提供します。
   
   - ADS の [SQL データの検出と分類](https://docs.microsoft.com/sql/relational-databases/security/sql-data-discovery-and-classification?view=azuresqldb-mi-current&tabs=t-sql)機能は、データベース内の機密データの検出、分類、ラベル付け、レポート作成を行える新しいツールです。高度な一連のサービスが導入され、データベースだけでなくデータベース内のデータも保護することを目的とした、新しい SQL Information Protection パラダイムが形成されています。
   
   - [SQL 脆弱性評価サービス](https://docs.microsoft.com/azure/azure-sql/database/sql-vulnerability-assessment)は、データベースのセキュリティ状態を可視化します。このサービスには、セキュリティの問題を解決し、データベースのセキュリティを強化するために実践できる手順が含まれています。
   
   - Azure SQL Managed Instance の[高度な脅威検出](https://docs.microsoft.com/azure/azure-sql/database/threat-detection-overview)は、データベースへのアクセスや悪用を試みる、通常とは異なる、害を及ぼす可能性がある異常なアクティビティを検出します。
   
   - [Transparent Data Encryption](https://docs.microsoft.com/azure/azure-sql/database/transparent-data-encryption-tde-overview?tabs=azure-portal) は、保存データを暗号化します。これにより、悪意のある者がドライブやバックアップ テープなどの物理メディアからデータを取得する可能性を防ぐことができます。
   
   - [動的データ マスク](https://docs.microsoft.com/azure/azure-sql/database/dynamic-data-masking-overview) (DDM) は、特権のないユーザーに対して機密データをマスクすることにより、機密データの公開を制限します。この機能を使用すると、アプリケーション レイヤーに対する影響を最小限に抑えながら、表示する機密データの量を指定して、機密データに対する未承認のアクセスを防ぐことができます。これはポリシーベースのセキュリティ機能であり、指定されたデータベース フィールドに対するクエリの結果セット内の機密データが表示されないようにします。その際、データベース内のデータが変更されることはありません。
   
   - [行レベルのセキュリティ](https://docs.microsoft.com/sql/relational-databases/security/row-level-security?view=azuresqldb-mi-current) (RLS) を使用すると、クエリを実行するユーザーの特性 (たとえば、グループのメンバーシップや実行コンテキストなど) に基づいて、データベース テーブル内の行へのアクセスを制御できます。行レベルのセキュリティ (RLS) は、アプリケーションにおけるセキュリティの設計やコーディングを簡素化します。RLS により、データ行アクセスの制限を実装できます。たとえば、従業員が自分が所属する部署に関連するデータ行にしかアクセスできないよう徹底したり、データ アクセスを関連するデータのみに制限したりすることができます。

5. ゲーミング データベースに対して直接実行される読み取り専用レポートの影響を低減するために利用できる PaaS データベース サービスの機能はあるか?
   
   Business Critical サービス レベルの SQL MI に含まれる各データベースは、可用性 SLA を支えるため、自動的にいくつかの AlwaysON レプリカとともにプロビジョニングされています。これは、1 つの読み取り専用レプリカの機能を使用して、読み取り専用ワークロードの負荷分散を可能にする[**読み取りスケールアウト**](https://docs.microsoft.com/azure/azure-sql/database/read-scale-out)と呼ばれる機能を提供します。　 読み取りスケールアウトを利用することで、パフォーマンスに影響を与えることなく、プライマリ読み取り/書き込みワークロードから読み取り専用ワークロードを分離できます。
   
   これは、分析などの論理的に分離された読み取り専用ワークロードを含むアプリケーション向けの機能です。したがって、追加コストなしでこの追加機能を利用して、パフォーマンスのメリットを享受できます。

ゲーミング サービス

1. WWI ではどのようにゲーミング サービス VM の Azure への移行に対応するべきか?
   
   同社は、Azure Site Recovery (ASR) を使用して、素早く簡単にオンプレミス VM を Azure VM にレプリケートすることを検討する必要があります。  ASR は事業継続とディザスター リカバリー向けに設計されていますが、Azure へのオンプレミス VM のレプリケーションを管理する目的でも利用できます。

2. 世界のその他の地域のゲーマーが経験している待機時間の問題を解決するためにどのような対策を推奨するか?
   
   同社は、ゲーマーによって報告されている待機時間の問題に対処するために、世界中の複数のリージョンの利用について検討する必要があります。プレイヤーにより近い場所でサービスを展開することで、プレイヤーがオンライン ゲーミング サービスにアクセスした際の待機時間を短縮できます。

3. ゲーミング サービスをスケールアップまたはスケールダウンするための機能はどのようなものであるべきか?
   
   ゲーミング サービスのスケーリングは、VM とデータベースの 2 つのレベルで行われます。
   
   まず、ゲーミング ソフトウェア仮想マシンに関しては、ゲームごとの VM スケール セットの使用について検討する必要があります。これにより、需要や定義されたスケジュールに応じて自動的に数の増減が可能な、負荷分散が行われる同一の VM のグループを作成して管理できます。
   
   データベースに関しては、マネージド インスタンスに割り当てられる仮想コアの数を増減できます。ただし、これは自動プロセスではなく、遅延やダウンタイムが発生する可能性があります。もう 1 つの選択肢は、新たなマネージド インスタンスを追加し、より多くのインスタンス間でワークロードを分散することです。

4. ゲーミング サービスの高可用性を実現するにはどうすればよいか?
   
   仮想マシン スケール セットを利用することで、ゲーミング ソフトウェアおよび認証 VM の高可用性を実現できます。データ センターの障害から保護するために、Availability Zones を使用するスケール セットを作成することもできます。
   
   Azure SQL Managed Instance は、組み込みの高可用性を備えています。トランザクション レプリケーションを利用することで、複数のリージョン間でデータを同期し続けることができます。

データ ウェアハウスとレポート

1. Azure でのデータ ウェアハウスのためのターゲット プラットフォームとして何を推奨するか?
   
   データ ウェアハウスに関しては、Azure Synapse Analytics または Azure SQL Database (Hyperscale サービス レベル) のいずれかを利用できます。Hyperscale サービス レベルが必要なのは、既存のデータ ウェアハウスの規模が大きいためです。
   
   お客様の要件を考慮に入れると、推奨されるアプローチは、Azure SQL Database (Hyperscale サービス レベル) への移行となります。これにより、アーキテクチャを一切変更することなく、既存の SQL Server 2008 R2 データ ウェアハウスとの最大限の互換性を実現できます。現在、お客様は実践的な DBA のスキルを備えていませんが、これにより移行が簡素化されます。一方、Azure Synapse Analytics に移行する場合、多少の再設計が必要になることがあります。また、お客様は、開発者とカスタマー サービス担当者がレポート作成、トラブルシューティング、他のアクティビティの目的でデータ ウェアハウスに直接接続すると述べています。Azure Synapse Analytics では、選択したサービス レベルに応じて、最大 4 ～ 128 個の同時クエリが可能であるため、多くのユーザーがデータ ウェアハウスに同時にアクセスした場合に問題が生じる可能性があります。

2. より多くの要求を処理できるようデータ ウェアハウスを読み取りスケールアウトするにはどうすればよいか?
   
   Hyperscale サービス レベルは、拡張性に優れたストレージおよびコンピューティング パフォーマンス層で、Azure アーキテクチャを活用して、Azure SQL Database のためのストレージおよびコンピューティング リソースを General Purpose および Business Critical サービス レベルの制限を大きく超えてスケールアウトできます。
   
   SQL DB Hyperscale は、スケールアウトとスケールアップを素早く行える機能を提供します。スケールアウトでは、読み取り専用ワークロードのオフロード用とホット スタンバイ用に、1 つ以上の読み取り専用ノードをプロビジョニングします。読み取りスケールアウトは、接続文字列で `ApplicationIntent` 引数を使用して、Hyperscale データベースの読み取り専用のセカンダリ レプリカに要求を送信します。スケールアップでは、負荷の高いワークロードに対応できるようにコンピューティング リソースをスケールアップした後、追加リソースが不要になった時点で再びスケールダウンします。

3. SSIS パッケージ、SSAS キューブ、および SSRS レポートのアップグレード パスはどのようなものか?
   
   ![SQL Server Services のアップグレード/置換パスの図 (SSIS が Azure Data Factory の Azure-SSIS Integration Runtime に移行され、SSAS が Azure Analysis Services に移行され、SSRS が Power BI に移行されることを示している)。](media/sql-services-upgrade-path.png "SQL Services (SSxS) のアップグレード パス")
   
   SSIS
   
   SSIS は、Azure Data Factory の Azure-SSIS Integration Runtime に置換されます。通常、SSIS パッケージは、SQL Server Data Tools (SSDT) または SQL Server Management Studio (SSMS) を使用して SSIS パッケージを展開して実行するシンプルなリフト アンド シフト アプローチを用いて ADF に移行できます。
   
   あるいは、Azure VM 上の SQL Server を使用して SSIS を展開することもできます。
   
   SSAS キューブ
   
   Azure Analysis Services (Azure AS) は、オンプレミス SSAS の PaaS バージョンです。表形式モデルは、Visual Studio を使用して SSAS から Azure AS に移行できます。
   
   あるいは、Azure VM 上の SQL Server を使用して SSAS を展開することもできます。
   
   SSRS
   
   SSRS と同等の PaaS は存在しないため、Azure VM (IaaS) 上で SSRS を実行するか、Microsoft Power BI のレポート機能に基づいてレポートを再作成する必要があります。

地域的な障害

1. ゲーミング サービスを指定された RTO/RPO 内で回復するにはどうすればよいか?
   
   データ センターの障害や地域的な障害から保護するために、仮想マシンで Availability Zones を使用する必要があります。  Availability Zones により、5 つのリージョンに VM を分散させて、全面的障害の発生可能性を低くすることができます。
   
   ゲーミング データベースについては、Azure SQL Managed Instance の自動フェールオーバー グループを構成する必要があります。自動フェールオーバー ポリシーとともに自動フェールオーバー グループを使用すると、グループ内の 1 つまたは複数のデータベースに影響を及ぼす障害が発生した場合、自動フェール オーバーが行われます。また、自動フェールオーバー グループには、フェールオーバー中にそのまま残る読み取り/書き込みリスナー エンドポイントと読み取り専用リスナー エンドポイントが用意されています。手動または自動フェールオーバーのアクティブ化のどちらを使用する場合でも、フェールオーバーはグループ内のすべてのセカンダリ データベースをプライマリに切り替えます。データベースのフェールオーバーが完了した後、DNS レコードが自動的に更新され、エンドポイントが新しいリージョンにリダイレクトされます。
   
   > 注:  Managed Instance の自動フェールオーバー グループは、現在パブリック プレビューで提供されています。プレビュー 機能を使用したくない場合、手動フェールオーバー プロセスを実施する必要があります。これには、別リージョンにあるもう 1 つの SQL MI へのトランザクション レプリケーションのセットアップが必要な場合があります。仮想ネットワーク間で VNet ピアリングを確立する必要があります。
   
   データ ウェアハウスについては、geo リストアの回復パターンを利用して、RTO と RPO を最低限に抑える必要があります。geo リストアを利用して、自動メンテナンスされる geo 冗長バックアップから代替の回復リージョンにカタログおよびテナント データベースを回復します。障害が解決したら、geo レプリケーションを使用して、変更されたデータベースを元のリージョンに戻します。

## 反論への推奨される対応のチェックリスト

1. Azure で SQL データベースをホストするための複数のオプションがあるように見える。それぞれのオプションはどのようなものか、また違いは何か? すべてのオプションはオンプレミスの SQL Server インスタンスとして同じ機能をサポートするのか、それとも移行前に注意すべきサポートされない機能があるのか?
   
   実際に、Azure で SQL データベースをホストするオプションは複数存在します。これらのオプションは重複する要素もありますが、以下のように、それぞれ固有のユース ケースやシナリオを対象にしています。
   
   Azure SQL Database (SQL DB)
   
   SQL DB は、Azure のフルマネージドの汎用リレーショナル DBaaS (サービスとしてのデータベース) プラットフォームです。最新の安定したバージョンの Microsoft SQL Server データベース エンジンに基づいて構築されており、インフラストラクチャを管理せずに使用できる、高いパフォーマンス、使いやすさ、信頼性、およびセキュリティを兼ね備えたデータベースを提供します。単一のデータベースとしても利用でき、エラスティック プール (一連の共有リソースが含まれるデータベースのコレクション) としても利用できます。
   
   SQL DB は、組み込みの高可用性、インテリジェンス、管理機能など、オンプレミス SQL Server では利用できない追加機能を備えています。また、素早く簡単にスケールアップやスケールアウトを行い、中断なしで能力を向上できるオプションも備えています。
   
   設計上、Azure SQL DB は、分離されたマルチテナント モデルを使用し、サービスのすべてのクライアント間で物理リソースを共有する必要があります。つまり、通常、サーバー レベルの機能は制約があるか、サポートされません。SQL Server ユーティリティ、SQL トレース、プロファイラー、数多くのシステム テーブルなど、さまざまなツールが利用できなくなります。その代わりに、診断や正常性の監視を実現するさまざまなビューを利用できます。
   
   設計上の相違により、SQL DB とは異なる、または SQL DB ではサポートされない SQL Server の機能もいくつか存在します。相違点としては、Transact SQL (T-SQL) の相違点 (サポートされないデータ型、関数、演算子、ステートメント、プロシージャ、システム テーブルおよびビューなど) などがあります。サポートされない機能には、分散トランザクション、SQL エージェント ジョブ、.NET CLR の統合、Filestream、拡張ストアド プロシージャ、Service Broker などがあります。
   
   Azure SQL DB は、最新の安定した SQL Server の機能の利用が必要な新しいクラウド ネイティブ アプリケーションや既存のアプリケーションに最適です。また、データベース インフラストラクチャの構成と管理のためのリソースを採用したくないチームにもお勧めです。
   
   Azure SQL Managed Instance (SQL MI)
   
   SQL MI は、オンプレミス SQL Server データベース インスタンスとのほぼ 100% の互換性を実現する、Azure でホストされる、フルマネージドの PaaS の SQL Server データベース エンジン インスタンスです。SQL DB とは異なり、分離されたマルチテナント モデルを使用しませんが、その代わりに、オンプレミス SQL Server のお客様の数多くの一般的な分離やセキュリティに関する懸念事項に対応する、ネイティブの仮想ネットワーク (VNet) の実装機能を提供します。つまり、既存の SQL Server データベースをクラウドに移行するのに最適な PaaS オプションです。
   
   マネージド インスタンス モデルにより、既存の SQL Server のお客様は、アプリケーションとデータベースの変更を最小限に抑えて、オンプレミス アプリケーションをクラウドにリフト アンド シフトできます。Azure SQL Database の展開オプションとして、管理オーバーヘッドと TCO を大幅に削減するすべての PaaS 機能を保持しています。オンプレミス SQL の機能の大半がサポートされますが、Filestream など、利用できない機能もあります。SQL DB とは異なり、SQL MI は、分散トランザクション、SQL エージェント ジョブ、.NET CLR の統合、Service Broker をサポートします。
   
   Azure SQL MI は、最新の安定した SQL Server の機能の利用が必要であり、変更を最小限に抑えてクラウドに移行する必要がある新しいクラウド ネイティブ アプリケーションや既存のアプリケーションに最適です。また、データベース インフラストラクチャの構成と管理のためのリソースを採用したくないチームにもお勧めです。
   
   Azure VM 上の SQL Server
   
   Azure VM 上の SQL Server の実行は、アプリケーションを一切変更することなく、既存データベースのクラウドへの 100% の互換性を備えた移行を可能にする IaaS アプローチです。Windows、Linux を問わず、あらゆるマシン サイズのあらゆる SQL Server のバージョンおよびエディションで実行可能です。Azure VM 上の SQL Server は、SQL Server のワークロードをオンプレミスからクラウドに移行するシームレスかつ簡単な手段を提供します。チームは、オンプレミス ハードウェアを管理する必要はなくなりますが、OS、データベース、アプリケーションの修正プログラム適用など、基礎となるインフラストラクチャは引き続き管理する必要があります。このオプションは、複数のデータベースがある場合はコストが高くなる可能性があり、スケーリングも難しくなります。高可用性は、SQL Server 可用性グループによって実現されます。
   
   Azure VM 上の SQL Server は、データベースの完全な制御が必要な場合や、Filestream やファイル グループなど、Azure SQL DB や SQL MI でサポートされていない機能をソース データベースが使用している場合に適した選択肢です。このアプローチは、メンテナンスや修正プログラム適用のスケジュールを業務に最適になるように設定する必要があるチームにお勧めです。また、SQL Server 2008 R2 を実行している場合、Azure VM にデータベースを移行することで、サポートが終了する 2019 年 7 月以降もさらに 3 年間サポートが提供されます。

2. Azure のさまざまな SQL Database ホスティング オプションのうちどれが当社の現在の SQL Server 2008 R2 データベースで動作するかを評価するためのツールはあるか? その他の SQL バージョンに対して対象となるワークロードをテストする方法があるか? 移行を試行する前に潜在的な問題や非互換性を識別するためのツールがあるか?
   
   マイクロソフトは、クラウドへの移行とデータベースのアップグレードを支援するさまざまなツールを提供しています。
   
   Database Experimentation Assistant (DEA)
   
   Database Experimentation Assistant (DEA) は、SQL Server のアップグレードのための A/B テスト ソリューションです。ターゲット バージョンの SQL Server または SQL Database に対する特定ワークロードの評価を支援します。DEA は移行ツールではありませんが、これを利用することで、移行に適したターゲット バージョンの SQL Server または SQL Database を確認できます。
   
   DEA は、以下の 3 つの手順を行うことで A/B テストを実施するためのガイダンスを提供します。
   
   - **キャプチャ**: SQL Server の A/B テストの最初の手順として、ソース サーバーでトレースをキャプチャします。トレース ファイルがそのサーバー上のクエリ ワークロード全体をキャプチャします。
   - **リプレイ**: SQL Server の A/B テストの次の手順として、ターゲット サーバーでキャプチャされたトレース ファイルをリプレイした後、分析のためにリプレイから広範なトレースを収集します。
   - **分析**: 最後の手順として、リプレイ トレースを使用して、分析レポートを生成します。この分析レポートにより、変更案の影響に関する洞察を得ることができます。
   
   DEA が提供する分析メトリックを利用することで、旧バージョンの SQL Server (2005 以降) から新バージョンにアップグレードするお客様は、互換性のエラー、クエリやクエリ プランのパフォーマンスの低下、他のワークロードの比較データを確認できます。この比較データにより、自信を深め、より効果的にアップグレードを行うことができます。
   
   Database Migration Assistant (DMA)
   
   Data Migration Assistant (DMA) は、ターゲット バージョンの SQL Server または Azure SQL Database へのアップグレードや移行に影響を与える可能性のある互換性や機能パリティの問題を検出することで、最新のデータ プラットフォームへのアップグレードを可能にします。また、ターゲット環境へのデータベースの移行後に実施できるパフォーマンスと信頼性の向上に関する推奨事項も示します。さらに、スキーマ、データ、含まれていないオブジェクト (SQL エージェント ジョブ、SSIS パッケージ、役割、ユーザー、およびログイン) をソース サーバーからターゲット サーバーに移行できます。
   
   Azure Database Migration Service (DMS)
   
   Azure Database Migration Service は、複数のデータベース ソースから Azure データ プラットフォームへ最小限のダウンタイムでシームレスに移行できるように設計されたフルマネージドのサービスです。包括的で可用性の高い移行ソリューションをお客様に提供します。このサービスは、Data Migration Assistant を使用して評価レポートを生成します。この評価レポートは、移行の実施前に必要な変更のガイドとなる推奨事項を示します。移行プロセスを開始する準備が整った時点で、Azure Database Migration Service がマイクロソフトが指定するベスト プラクティスに従って必要な手順をすべて実施します。
   
   DMS は、SQL データベースの移行だけでなく、MongoDB から Cosmos DB への移行、MySQL や PostgreSQL の Azure データ プラットフォームへの移行など、他のさまざまな種類のデータベースの移行にも利用できます。
   
   SQL Server Migration Assistant (SSMA)
   
   このシナリオ限定で利用されるツールではありませんが、知っておくべきもう 1 つのツールとして、SQL Server Migration Assistant (SSMA) が挙げられます。SSMA は、Microsoft Access、DB2、MySQL、Oracle、および SAP ASE から SQL Server または SQL Database へのデータベースの移行を自動化できるように設計されたツールです。

3. クラウドへの移行において、バックエンドのネットワークを完全に分離して、セキュリティで保護されたチャネルを介したフロントエンド接続のみを有効にした状態で、オンプレミスの開発環境に接続し、そこからトラブルシューティングを行う機能を保持できるか?
   
   はい。データベースやアプリケーションをクラウドに移行した後もこれは可能です。
   
   Azure SQL Managed Instance は、完全な VNet の分離を実現します。また、Azure 仮想ネットワーク、およびマネージド インスタンス専用のサブネット内に置かれます。そして、セキュアなプライベート IP アドレスを介してアクセスでき、その仮想ネットワーク内から接続できるようにします。
   
   管理および展開サービスは、外部ロード バランサーにマッピングされている管理エンドポイントを使用して、マネージド インスタンスに接続します。トラフィックは、マネージド インスタンスの管理コンポーネントのみが使用する事前定義された一連のポートで受信された場合のみ、ノードに転送されます。ノード上の組み込みファイアウォールは、マイクロソフトの IP 範囲からのトラフィックのみを許可するようにセットアップされています。証明書は、管理コンポーネントと管理プレーン間のすべての通信を相互に認証します。
   
   お客様のアプリケーションは、マネージド インスタンスに接続でき、仮想ネットワーク、ピアリングされた仮想ネットワーク、または VPN や Azure ExpressRoute で接続されたネットワーク内でデータベースに対するクエリと更新を行うことができます。このネットワークは、エンドポイントとプライベート IP アドレスを使用する必要があります。
   
   SQL MI への接続の複雑さをある程度軽減させるために、セキュアなパブリック エンドポイントを通して SQL MI にアクセスすることもできます。SQL MI は、既定で無効になっている専用のパブリック エンドポイント アドレスを保有しています。有効にすると、クライアント側の送信に関するファイアウォールおよびネットワークのセキュリティ グループ ルールによってこのエンドポイントへの送信接続が制限されます。接続の許可対象のトラフィックを既知の IP アドレスに制限することをお勧めします。

4. 特定のクラウド ベンダーに囲い込まれたくない。データベースをホストするために PaaS サービスを使用しつつ、同時に有効な出口戦略を持つことは可能か? あるいは、データベースのホストにあたっては あくまで Azure での VM の使用に限定しなくてはならないのか?
   
   はい。PaaS データベース サービスを使用しつつ、ベンダーのロックインを回避できます。[トランザクション レプリケーション](https://docs.microsoft.com/azure/azure-sql/managed-instance/replication-between-two-instances-configure-tutorial)を使用して、リモートの SQL Server データベース (他のクラウド ベンダーのクラウド内にあるものも含む) にデータをレプリケートできます。

## 顧客の声 (最後に出席者に対して読み上げる)

「Azure SQL Managed Instance と Azure Database Migration Service のおかげで、弊社は、最小限のダウンタイムで、自社のデータベース ワークロードをクラウドに移行できました。そして、SQL MI のおかげで、基礎となるサーバー ハードウェアやオペレーティング システムのメンテナンスについて心配することなく、ビジネス価値の向上に労力を集中させることができる、信頼性の高い、フルマネージドのクラウド データベースを見つけることができました」

Wide World Importers の CIO、Molly Fischer 氏