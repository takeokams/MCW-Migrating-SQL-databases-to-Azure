![マイクロソフト クラウド ワークショップ](https://github.com/Microsoft/MCW-Template-Cloud-Workshop/raw/master/Media/ms-cloud-workshop.png "マイクロソフト クラウド ワークショップ")

<div class="MCWHeader1">
Migrating SQL databases to Azure
</div>

<div class="MCWHeader2">
Whiteboard design session student guide
</div>

<div class="MCWHeader3">
June 2020
</div>

このドキュメントに記載されている情報 (URL 等のインターネット Web サイトに関する情報を含む) は、将来予告なしに変更されることがあります。特に断りがない限り、ここで使用している会社、組織、製品、ドメイン名、電子メール アドレス、ロゴ、人物、場所、イベントの例は、架空のものであり、実在する会社、組織、製品、ドメイン名、電子メール アドレス、ロゴ、人物、場所、イベントなどとは一切関係ありません。お客様ご自身の責任において、適用されるすべての著作権関連法規に従ったご使用を願います。このドキュメントのいかなる部分も、米国 Microsoft Corporation の書面による許諾を受けることなく、その目的を問わず、どのような形態であっても、複製または譲渡することは禁じられています。ここでいう形態とは、複写や記録など、電子的な、または物理的なすべての手段を含みます。ただしこれは、著作権法上のお客様の権利を制限するものではありません。

マイクロソフトは、このドキュメントに記載されている内容に関し、特許、特許申請、商標、著作権、またはその他の無体財産権を有する場合があります。別途マイクロソフトのライセンス契約上に明示の規定のない限り、このドキュメントはこれらの特許、商標、著作権、またはその他の無体財産権に関する権利をお客様に許諾するものではありません。

製造元や製品の名前、URL は情報の提供のみを目的としており、マイクロソフトは、これらの製造元、またはマイクロソフトの技術での製品の使用について、明示的、黙示的、または法的にいかなる表示または保証も行いません。製造元または製品の使用は、マイクロソフトによるその製造元または製品の推奨を意味するものではありません。サード パーティのサイトへのリンクが提供されている場合があります。このようなサイトはマイクロソフトの管理下にはなく、マイクロソフトは、リンクされたサイトの内容またはリンクされたサイトに含まれるリンク、あるいはこのようなサイトの変更または更新について責任を負いません。マイクロソフトは、リンクされたサイトから受信された Web キャストまたは他のいかなる形態の転送にも責任を負いません。マイクロソフトは、これらのリンクを便宜のみを目的として提供しており、いかなるリンクの使用も、マイクロソフトによるサイトまたはそこに含まれる製品の推奨を意味するものではありません。

© 2020 Microsoft Corporation.All rights reserved.

Microsoft および <https://www.microsoft.com/en-us/legal/intellectualproperty/Trademarks/Usage/General.aspx> に記載されている商標は、Microsoft グループの商標です。その他すべての商標は、該当する各社が所有しています。

**目次**

- [Azure への SQL データベースの移行のためのホワイトボード設計セッション受講者ガイド](#azure-への-sql-データベースの移行のためのホワイトボード設計セッション受講者ガイド)
    - [要約と学習目的](#要約と学習目的)
    - [ステップ 1: 顧客のケース スタディの確認](#ステップ-1-顧客のケース-スタディの確認)
        - [顧客の状況](#顧客の状況)
        - [お客様のニーズ](#お客様のニーズ)
        - [顧客の反論](#顧客の反論)
        - [一般的なシナリオのインフォグラフィック](#一般的なシナリオのインフォグラフィック)
    - [ステップ 2: 概念実証ソリューションの設計](#ステップ-2-概念実証ソリューションの設計)
    - [ステップ 3: ソリューションをプレゼンテーションする](#ステップ-3-ソリューションをプレゼンテーションする)
    - [まとめ](#まとめ)
    - [追加リファレンス](#追加リファレンス)

# Azure への SQL データベースの移行のためのホワイトボード設計セッション受講者ガイド

## 要約と学習目的

このホワイトボード設計セッションでは、オンプレミスの VM と SQL Server 2008 R2 データベースを Azure 内の IaaS サービスと PaaS サービスの組み合わせに移行する計画をグループで作成します。トレーナーは、評価を実施して、顧客の SQL Server 2008 R2 データベースと Azure のマネージド データベース オファリングとの間の機能のパリティと互換性の問題を明らかにするためのガイダンスを提供します。次に、最小限のダウンタイムまたはゼロ ダウンタイムで顧客の VM およびデータベースを含むオンプレミス サービスを Azure に移行するためのソリューションを設計します。最後に、Azure で高度な SQL 機能のいくつかを有効にして、顧客のアプリケーションにおけるセキュリティとパフォーマンスを向上する方法についてのガイダンスを提供します。

このホワイトボード設計セッションを完了すると、ビジネス クリティカルなアプリケーションとデータベースのクラウド移行ソリューションをより効果的に設計できるようになります。

## ステップ 1: 顧客のケース スタディの確認

**成果**

顧客のニーズを分析する

所要時間: 15 分

指示: セッションの参加者全員と共に、ファシリテーター/SME は、顧客のケース スタディの概要を技術的なヒントと併せてプレゼンテーションします。

1. テーブルの参加者およびトレーナーと打ち合わせを行います。

2. 受講者ガイドのステップ 1 ～ 3 の指示をすべて読みます。

3. テーブル チームとして、次の顧客のケース スタディを確認します。

### 顧客の状況

Wide World Importers (WWI) の子会社である Tailspin Toys は、いくつかの人気のあるオンライン ゲームを開発した企業です。2010 年に設立された同社は、オンラインの多人数ゲームを含んだ、非常に人気のあるゲーム シリーズの第一弾リリース以降、急激な成長を遂げました。以来、同社はゲーム ポートフォリオの大部分にオンライン機能を追加することで、その成功を積み重ねてきました。

オンライン ゲームプレイを促進するために、同社は保守的なアプローチを取ることにし、レンタルのハードウェアを使用してオンプレミスでゲーミング サービスをホストしました。このアプローチによって、最小限の初期投資でオンライン ゲーム市場に参入し、リスクを低減することができました。各ゲームに対して、同社のゲーミング サービスのセットアップは、ゲーミング ソフトウェアを実行する 3 台の仮想マシンと、単一の SQL Server 2008 R2 Enterprise インスタンス上でホストされる 5 台のゲーム データベースで構成されます。これらは、ゲーミング データベース間でメッセージを送信するために SQL Server の Service Broker 機能を使用します。専用のゲーミング VM およびデータベースに加えて、同社のゲーミング サービスには認証およびゲートウェイの VM およびデータベースが含まれており、すべてのゲームで共有されています。

WWI の CIO である Molly Fischer 氏は、オンライン ゲームプレイを追加したことで、当初の予想をはるかに上回る反応があったと語りました。ゲームの人気上昇で収益性は向上しましたが、サービスの需要の急激な増加によって、現在のセットアップをサポートする上で問題が生じるようになりました。Tailspin Toys は基本的にゲーム開発企業であり、主にソフトウェア開発者によって構成されています。データベースおよびインフラストラクチャ専門のリソースは少数で、拡大を続けるワークロードに対応するのに苦戦しています。ゲーム開発者がインフラストラクチャのサポートを支援するために介入しなければならないことがますます増え、ゲーム開発にあてる時間が奪われ、リリースのタイムラインを守れなくなる事態が何度か生じました。Molly 氏は、コア ビジネスの範囲外のことになるため、追加の非開発者リソースを投入することに対する懸念を表しています。彼女は、サービスをオンプレミスからクラウドに移行することによって、インフラストラクチャ管理タスクをいくらか軽減できると同時に、新しい改良されたゲームをリリースすることでビジネス価値を提供するという同社の取り組みに再度集中できるようになることを期待しています。

この問題をさらに複雑化させているのが、一番人気のゲームの新しいバージョンのリリース スケジュールです。同社には 12 ～ 18 か月ごとに新しいバージョンをリリースするという目標スケジュールがありますが、これはリリースする新しいバージョンごとに新しい VM 数台とデータベース サーバー 1 台を追加することを意味し、その一方で以前のゲーム バージョンすべてのサービスを維持し続ける必要があります。新しいリリースごとに、レンタル機器のコストが増加し、ただでさえ過剰負担状態にある従業員のワークロードをさらに着実に増やしていくことになります。同社は社内で古いゲーム バージョンのサポート終了シナリオについて話し合いましたが、これらのゲームの多くで依然として多くのプレイヤーが存在しているため、これらのゲームをいつサポート終了にするかについての決定は結局行われませんでした。

WWI は、現在のハードウェア レンタル契約が 3 か月で終了するため、契約更新はせず、既存の VM を Azure に移行したいと考えています。3 か月という期間はいかにも短いことは重々承知の上で、適切なリソースを専用に割り当てるなら、ゲーミング サービス VM のリフト アンド シフト アプローチが実現可能なのではないかと期待しています。同社には既に、このプロセスに使用できる、各ゲームの VM イメージがあります。彼らはリフト アンド シフトに関係する作業についてさらに詳しく知って、それに基づいてリソース割り当てを計画することを望んでいます。さらに、このアプローチを使用して VM およびデータベース展開をゲームごとにさらに適切にスケーリングできるかということも知りたいと願っています。現在、各ゲームとバージョンに同じ数の VM とデータベースを使用していますが、人気のあるゲームではより多くのゲーマーをホストしなければならないという問題にしばしば直面しています。新しいリリースとより人気のあるゲームの需要を満たすためにスケールアップし、古い、人気の低いゲームではスケールダウンできる能力を必要としています。また、ゲーミング サービスをグローバルに配信することで、世界中のさまざまな場所からサービスにアクセスするゲーマーによって報告される待機時間の問題を解決できるかどうかということも調査することを望んでいます。

WWI のリーダーシップ チームにとっての大きな懸念は、SQL Server 2008 R2 のサポート終了日が足早に迫っていることです。同社のデータベース向けに、Azure のフルマネージドの PaaS (サービスとしてのプラットフォーム) オプションについて詳しく知りたいと考えています。実際のデータベース管理スキルを持つ従業員がいないため、これはインフラストラクチャのワークロードを減らすための優れた最初の一歩になると感じています。同社は、現在のデータベース と Azure の Paas オプション間の互換性の問題を評価するための支援を要請しました。彼らは、SQL Server の Service Broker 機能が Azure では利用できないことを知りました。同社はいくつかの重要なゲーミング プロセスでこの機能を使用しており、ゲーミング データベースをクラウドに移行する際にこの機能を失うわけにはいきません。また、この時にゲーミング サービスを再設計して別のメッセージ ブローカーを使用するためのリソースがないということも述べています。

ゲーミング サービスに加えて、WWI はデータ ウェアハウスとその関連するサービスをクラウドに移行することにも関心を持っています。現在、専用の SQL Server 2008 R2 インスタンスにデータ ウェアハウスをホストしています。データ ウェアハウスのサイズは現在約 20 TB で、毎月約 250 GB のペースで増加しています。ゲーム サーバーのリモート監視および分析とユーザー テレメトリ (ゲームおよびその他の対話との対話などのプレイヤーの動作に関するデータ) を含む多数のゲーム テレメトリ データ ポイントを収集しています。ゲーミング ソフトウェアに埋め込まれたコードは、ゲーミング データベースにデータを転送します。そのテレメトリ データは、SQL Server Integration Services (SSIS) によって 1 時間ごとに読み込まれます。データ ウェアハウス内のデータを使用して、同社は SQL Server Analysis Services (SSAS) キューブを構築し、SQL Server Reporting Services (SSRS) を使用してレポートを作成します。SSRS レポートは SharePoint 環境内のサイトに展開されます。また、カスタマー サービス担当者と開発者がさまざまな活動のためにデータ ウェアハウスに接続することにも気付いています。

さらに、リアルタイムのユーザー テレメトリとゲーミング メトリックを分析できるように、いくつかのレポートはゲーミング データベースに対して直接実行されている点についても言及しました。このようなレポートは多くありませんが、開発者とビジネス ユーザーにとっては重要なものです。ゲーミング アクティビティのピーク時期に、これらのレポートの実行が非常に低速になり、ゲーミング パフォーマンスにも時折影響を及ぼしていることが観察されています。彼らは、これまでに経験しているパフォーマンスへの影響を軽減するような方法で、これらのレポートを引き続き実行する方法がないかどうかを知りたいと思っています。

WWI は、クラウドへの移行により、どのように全体的なプロセスを改善すると共に、オンプレミスのセットアップで抱えている懸念事項や問題を解決できることについてさらに詳しく知りたいとして、期待を高めています。目下、ゲーミング VM とデータベースをクラウドに移行するための概念実証 (PoC) を実施しようとしています。最終目標はサービス全体をクラウドに移行することであるため、クラウドへの移行後に全体的なアーキテクチャがどのようになるかをさらに詳しく理解したいと考えています。

現在の環境をより良く理解できるようにするため、WWI はオンプレミスのゲーミング サービス実装の以下のアーキテクチャ図を提供しています。

![現在のアーキテクチャ図。](media/current-architecture.png "現在のアーキテクチャ")

### お客様のニーズ

1. 可能な限り PaaS サービスを使用して、すべてのゲーミング サービス インフラストラクチャをクラウドに移行したい。機器レンタル契約を更新しなくてよいように、3 か月以内にこれを実行可能かどうかを知りたい。

2. ゲーミング サービスに加えて、既存のデータ ウェアハウスを Azure に移行して、そこで利用可能ないくつかの新しい SQL 機能によってスケールアウトする機能を活用したい。この要請の一環として、以下のことについて知りたい:
   
   - より多くの要求を処理できるようデータ ウェアハウスをスケールアウトする機能の追加。
   - SSIS パッケージ、SSAS キューブ、および SSRS レポートのアップグレード パス。

3. 移行コストを可能な限り最小限に抑える方法についての推奨事項を知りたい。

4. 当社のデータベースのセキュリティ体制を改善したい、また潜在的な脆弱性とコンプライアンスの問題について知りたい。

5. 世界中のその他の地域のゲーマーから高待機時間の不満が寄せられており、高使用率のピーク時にはゲームに参加できないという報告もある。当社のゲーミング サービスをクラウドに移行することで、以下の点を含む全体的なゲーミング エクスペリエンスを向上することを希望している。
   
   - 世界中のさまざまな場所から当社のサービスにアクセスするゲーマーの待機時間を削減する。
   - ピーク時または新しいゲームのリリース時により多くのプレイヤーをホストできるようにする。
   - 冗長性を追加してゲーミング サービスの高可用性を確保する

6. 地域的な障害発生時には、数分以内にゲーミング サービスを再開し、48 時間以内にデータ ウェアハウスを回復したい。

### 顧客の反論

1. Azure で SQL データベースをホストするための複数のオプションがあるように見える。それぞれのオプションはどのようなものか、また違いは何か? すべてのオプションはオンプレミスの SQL Server インスタンスとして同じ機能をサポートするのか、それとも移行前に注意すべきサポートされない機能があるのか? Azure の PaaS データベースで引き続き Service Broker を使用できるのか?

2. Azure のさまざまな SQL Database ホスティング オプションのうちどれが当社の現在の SQL Server 2008 R2 データベースで動作するかを評価するためのツールはあるか? その他の SQL バージョンに対して対象となるワークロードをテストする方法があるか? 移行を試行する前に潜在的な問題や非互換性を識別するためのツールがあるか?

3. クラウドへの移行において、バックエンドのネットワークを完全に分離して、セキュリティで保護されたチャネルを介したフロントエンド接続のみを有効にした状態で、オンプレミスの開発環境に接続し、そこからトラブルシューティングを行う機能を保持できるか?

4. 特定のクラウド ベンダーに囲い込まれたくない。データベースをホストするために PaaS サービスを使用しつつ、同時に有効な出口戦略を持つことは可能か? あるいは、データベースのホストにあたっては あくまで Azure での VM の使用に限定しなくてはならないのか?

### 一般的なシナリオのインフォグラフィック

![一般的なシナリオのインフォグラフィックが表示されている。](media/common-scenario-infographic.png "一般的なシナリオ")

## ステップ 2: 概念実証ソリューションの設計

**成果**

ソリューションを設計し、そのソリューションを 15 分のチョークトーク形式で顧客の対象者にプレゼンテーションする準備をする

所要時間: 60 分

**ビジネス ニーズ**

指示: テーブルのすべての参加者と共に以下の質問に回答し、回答をフリップ チャートに一覧にします。

1. このソリューションを誰にプレゼンテーションするべきか。顧客の対象者は誰か。意思決定者は誰か。

2. ソリューションで解決する必要がある顧客のビジネス ニーズは何か。

**設計**

指示: テーブルのすべての参加者と共に、フリップ チャートの次の質問に回答します。

_アーキテクチャの概要_

1. 詳細には触れずに (詳細には以降のセクションで対応)、ゲーム データベース、ゲーミング サービス VM、データ ウェアハウス、および関連するサービスに関する最上位の要件に対応するための初期ビジョンを図示する。この図は作業の進行に伴って詳細にしていく。

2. 移行コストをどのように最小限に抑えられるか?

3. WWI のゲーミング サービスを 3 か月以内に移行することは可能か?

4. どのような機能を POC に含める必要があるか?

_ゲーム データベース_

1. WWI が Azure で SQL データベースをホストするために PaaS または IaaS オプションのどちらを使用するかを決定する際に考慮すべき要素にはどのようなものがあるか?

2. Azure で SQL データベースをホストするためのオプションのうち、同社のゲーミング サービスをホストするためにどれを推奨するか、それが最適な選択肢であると考える理由は何か? どのような価格レベルを推奨するか?

3. データ移行にどのように対応するか? 評価からデータ移行にいたるまでの段階的な説明を提供してください。

4. WWI のセキュリティ体制を改善するために Azure SQL Managed Instance で利用可能な機能にはどのようなものがあるか?

5. ゲーミング データベースに対して直接実行される読み取り専用レポートの影響を低減するために利用できる PaaS データベース サービスの機能はあるか?

_ゲーミング サービス_

1. WWI ではどのようにゲーミング サービス VM の Azure への移行に対応するべきか?

2. 世界のその他の地域のゲーマーが経験している待機時間の問題を解決するためにどのような対策を推奨するか?

3. ゲーミング サービスをスケールアップまたはスケールダウンするための機能はどのようなものであるべきか?

4. ゲーミング サービスの高可用性を実現するにはどうすればよいか?

_データ ウェアハウスとレポート_

1. Azure でのデータ ウェアハウスのためのターゲット プラットフォームとして何を推奨するか?

2. より多くの要求を処理できるようデータ ウェアハウスを読み取りスケールアウトするにはどうすればよいか?

3. SSIS パッケージ、SSAS キューブ、および SSRS レポートのアップグレード パスはどのようなものか?

_地域的な障害_

1. ゲーミング サービスを指定された RTO/RPO 内で回復するにはどうすればよいか?

**準備**

指示: テーブルのすべての参加者と共に、以下を行います。

1. 提案したソリューションでは対応していない顧客ニーズを特定する。

2. ソリューションの利点を特定する。

3. 顧客の反論にどのように回答するかを決定する。

顧客に対する 15 分のチョークトーク形式のプレゼンテーションを準備する。

## ステップ 3: ソリューションをプレゼンテーションする

**成果**

顧客の対象者にソリューションを 15 分のチョークトーク形式でプレゼンテーションする

所要時間: 30 分

**プレゼンテーション**

指示:

1. 別のテーブルとペアを組む

2. 一方のテーブルはマイクロソフト チーム、他方のテーブルは顧客とする

3. マイクロソフト チームは提案ソリューションを顧客にプレゼンテーションする

4. 顧客は反論リストから反論を 1 つ行う

5. マイクロソフト チームは反論に回答する

6. 顧客チームはマイクロソフト チームにフィードバックを提供する

7. テーブル間で役割を切り替えて、ステップ 2 ～ 6 を繰り返す

## まとめ

所要時間: 15 分

指示: より大きなグループでテーブルに再度集まり、ファシリテーター/SME がこのケース スタディの推奨ソリューションを共有するのを聞きます。

## 追加リファレンス

| | |
|----------|----------
| **説明** | **リンク**
| Azure で適切な SQL Server オプションを選択する| <https://docs.microsoft.com/azure/azure-sql/azure-sql-iaas-vs-paas-what-is-overview>
| サービスとしての SQL Database プラットフォーム| <https://docs.microsoft.com/azure/azure-sql/database/sql-database-paas-overview>
| ビジネス継続性| <https://docs.microsoft.com/azure/azure-sql/database/business-continuity-high-availability-disaster-recover-hadr-overview>
| 高可用性| <https://docs.microsoft.com/azure/azure-sql/database/high-availability-sla>
| 自動バックアップ| <https://docs.microsoft.com/azure/azure-sql/database/automated-backups-overview>
| 長期的なバックアップ保有期間| <https://docs.microsoft.com/azure/azure-sql/database/long-term-retention-overview>
| 自動フェールオーバー| <https://docs.microsoft.com/azure/azure-sql/database/auto-failover-group-overview>
| リソースのスケーリング| <https://docs.microsoft.com/azure/azure-sql/database/scale-resources>
| 機能比較: Azure SQL Database と SQL Server| <https://docs.microsoft.com/azure/azure-sql/database/features-comparison>
| Azure SQL Managed Instance| <https://docs.microsoft.com/azure/azure-sql/managed-instance/sql-managed-instance-paas-overview>
| SQL MI 用の接続アーキテクチャ| <https://docs.microsoft.com/azure/azure-sql/managed-instance/connectivity-architecture-overview>
| アプリを SQL MI に接続する| <https://docs.microsoft.com/azure/azure-sql/managed-instance/connect-application-instance>
| Azure SQL Database サービス レベル| <https://docs.microsoft.com/azure/azure-sql/database/service-tiers-general-purpose-business-critical>
| Azure SQL MI の概要| <https://docs.microsoft.com/azure/azure-sql/managed-instance/quickstart-content-reference-guide>
| データベース移行ガイド| <https://datamigration.microsoft.com>
| Database Migration Assistant| <https://docs.microsoft.com/sql/dma/dma-overview?view=azuresqldb-mi-current>
| Azure Database Migration Service| <https://docs.microsoft.com/azure/dms/dms-overview>
| SQL Server から Azure SQL Managed Instance への移行| <https://datamigration.microsoft.com/scenario/sql-to-azuresqldbmi>
| Azure SQL Managed Instance への移行| <https://docs.microsoft.com/azure/dms/tutorial-sql-server-to-managed-instance?toc=/azure/sql-database/toc.json>
| DMS を使用した SQL Server から Azure SQL Managed Instance への移行| <https://docs.microsoft.com/azure/dms/tutorial-sql-server-managed-instance-online?view=sql-server-2017>
| Azure SQL Database の価格| <https://azure.microsoft.com/pricing/details/sql-database/managed>
| Azure SQL Database のセキュリティ機能の概要| <https://docs.microsoft.com/azure/azure-sql/database/security-overview>
| Advanced Data Security| <https://docs.microsoft.com/azure/azure-sql/database/advanced-data-security>
| データの検出および分類| <https://docs.microsoft.com/azure/azure-sql/database/data-discovery-and-classification-overview>
| SQL 脆弱性評価サービス| <https://docs.microsoft.com/azure/azure-sql/database/sql-vulnerability-assessment>
| 脅威検出| <https://docs.microsoft.com/azure/azure-sql/database/threat-detection-overview>
| SQL Database 読み取りスケールアウト| <https://docs.microsoft.com/azure/azure-sql/database/read-scale-out>

